<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food Analysis Assistant</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      font-family: 'Segoe UI', sans-serif;
    }

    .result-box {
      background: white;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      margin-top: 20px;
    }

    .section-title {
      font-weight: bold;
      font-size: 1.2rem;
      margin-top: 20px;
    }

    .badge-box {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 10px;
      background: #e9ecef;
      margin: 2px;
    }

    .text-green {
      color: #28a745;
    }

    .text-red {
      color: #dc3545;
    }
  </style>
</head>

<body>
  <div class="container py-5">
    <h2 class="text-center mb-4">ğŸ½ï¸ Food Analysis Assistant</h2>
    <div class="text-center">
      <input type="file" id="fileInput" accept="image/*" class="form-control mb-3" style="max-width: 400px; margin: auto;">
      <button class="btn btn-primary" onclick="startAnalysis()">ğŸ” Analisa Sekarang</button>
    </div>

    <div id="loading" class="text-center d-none mt-3">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">Memproses gambar...</p>
    </div>

    <div id="resultContainer" class="result-box d-none">
      <div class="section-title">ğŸ“Š Hasil Analisis:</div>

      <div class="mt-3">
        <strong>ğŸ§  Skor Kesehatan:</strong>
        <div id="direkomendasikanAtauTidak" class="mb-1"></div>
        <p id="alasan" class="text-muted"></p>
      </div>

      <div class="mt-4">
        <strong class="section-title">ğŸ“‹ Rincian Nutrisi:</strong>
        <ul id="rincianNutrisi"></ul>
      </div>

      <div class="mt-4">
        <strong class="section-title">ğŸ’Š Vitamin & Mineral:</strong>
        <ul id="vitaminMineral"></ul>
      </div>

      <div class="mt-4">
        <strong class="section-title">ğŸ” Analisis Bahan:</strong>
        <p id="analisisBahan"></p>
      </div>

      <div class="mt-4">
        <strong class="section-title">ğŸ¥— Alternatif Lebih Sehat:</strong>
        <p id="alternatifSehat"></p>
      </div>
    </div>
  </div>

  <script>
    let selectedFile;
    document.getElementById('fileInput').addEventListener('change', function (e) {
      selectedFile = e.target.files[0];
    });

    async function startAnalysis() {
      if (!selectedFile) return;

      const formData = new FormData();
      formData.append('image', selectedFile);

      document.getElementById('loading').classList.remove('d-none');
      document.getElementById('resultContainer').classList.add('d-none');

      try {
        const res = await axios.post('https://food-analyzer.exoduscloud.my.id/analyze', formData);
        const data = res.data;

        const skorData = data.skorKesehatan || {};
        document.getElementById('alasan').textContent = skorData.alasan || '-';
        document.getElementById('direkomendasikanAtauTidak').innerHTML =
          skorData.direkomendasikanAtauTidak && skorData.direkomendasikanAtauTidak.toLowerCase().includes('tidak')
            ? '<span class="text-red">ğŸ‘ Tidak Direkomendasikan</span>'
            : '<span class="text-green">ğŸ‘ Direkomendasikan</span>';

        const nutrisi = data.rincianNutrisi || {};
        const nutrisiList = document.getElementById('rincianNutrisi');
        nutrisiList.innerHTML = '';
        const fields = ['kalori', 'protein', 'proteinPersen', 'karbohidrat', 'karbohidratPersen', 'gemuk', 'gemukPersen'];
        fields.forEach(key => {
          if (nutrisi[key]) {
            const li = document.createElement('li');
            li.textContent = `${key.charAt(0).toUpperCase() + key.slice(1)}: ${nutrisi[key]}`;
            nutrisiList.appendChild(li);
          }
        });

        const vitaminList = document.getElementById('vitaminMineral');
        vitaminList.innerHTML = '';
        if (Array.isArray(nutrisi.vitaminDanMineral)) {
          nutrisi.vitaminDanMineral.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            vitaminList.appendChild(li);
          });
        }
        if (Array.isArray(nutrisi.mineral)) {
          nutrisi.mineral.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item;
            vitaminList.appendChild(li);
          });
        }

        document.getElementById('analisisBahan').textContent = (data.ingredients || []).join(', ') || '-';
        document.getElementById('alternatifSehat').textContent = (data.alternatif || []).join(', ') || '-';

        document.getElementById('resultContainer').classList.remove('d-none');
      } catch (error) {
        alert('Error analyzing image: ' + (error.response?.data?.error || error.message));
      } finally {
        document.getElementById('loading').classList.add('d-none');
      }
    }
  </script>
</body>

</html>
